# -*- coding: utf-8 -*-
# backend/import_work_types.py
# Запускати: python manage.py shell < import_work_types.py
import os
import sys
import django

sys.path.append(os.path.dirname(os.path.abspath(__file__)))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

# Тепер ваші імпорти
from users.models import WorkType, WorkSubType, Equipment

# Очищаємо старі дані (опціонально)
Equipment.objects.all().delete()
WorkSubType.objects.all().delete()
WorkType.objects.all().delete()

# Дані для імпорту
data = [
    ("Електрозварювальні, газополум'яні, наплавочні і паяльні роботи. Контроль за зварювальними з'єднаннями.", "Зварювальні, газополум'яні, а також наплавочні і паяльні роботи, що виконуються із застосуванням відкритого полум'я.", ""),
    ("Електрозварювальні, газополум'яні, наплавочні і паяльні роботи. Контроль за зварювальними з'єднаннями.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", ""),
    ("Роботи в охоронних зонах ліній електропередач.", "Роботи в охоронних зонах діючих магістральних трубопроводів та ліній електропередачі.", ""),
    ("Роботи в охоронних зонах ліній електропередач.", "Роботи, що виконуються на висоті понад 1,3 метра.", ""),
    ("Роботи в охоронних зонах ліній електропередач.", "Роботи в охоронних зонах діючих магістральних трубопроводів та ліній електропередачі.", "Устаткування напругою понад 1000 В."),
    ("Роботи на кабельних лініях і діючих електроустановках.", "Роботи в охоронних зонах діючих магістральних трубопроводів та ліній електропередачі.", "Устаткування напругою понад 1000 В."),
    ("Роботи з надзвичайно займистими, легкозаймистими, займистими та вибухонебезпечними речовинами.", "Виробництво (виготовлення), використання, переробка, зберігання, транспортування, застосування, утилізація та знешкодження вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки, горючих рідин, маса яких дорівнює або перевищує значення нормативів порогових мас", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Роботи з надзвичайно займистими, легкозаймистими, займистими та вибухонебезпечними речовинами.", "Злив, очистка, нейтралізація резервуарів, тари та інших ємностей з-під нафтопродуктів, кислот, лугів та інших небезпечних речовин, в тому числі радіоактивних.", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Транспортування балонів, контейнерів, ємностей із стисненими, зрідженими, отруйними, вибухонебезпечними та інертними газами, їх заповнення та ремонт", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", ""),
    ("Обслуговування агрегатів і котлів, працюючих на газі і рідкому паливі.", "Обстеження, ремонт і чищення димарів, повітропроводів, а також димових та вентиляційних каналів.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Роботи з профілактики і технічного обслуговування газового господарства.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", ""),
    ("Виконання газонебезпечних робіт.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Роботи по монтажу та зварюванню підземних та зовнішніх газопроводів, газифікації об'єктів, а також по нанесенню протикорозійного ізоляційного покриття.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", ""),
    ("Роботи по монтажу та зварюванню підземних та зовнішніх газопроводів, газифікації об'єктів, а також по нанесенню протикорозійного ізоляційного покриття.", "Роботи в колодязях, шурфах, траншеях, котлованах, бункерах, камерах, колекторах, замкнутому просторі (ємностях, боксах, топках, трубопроводах тощо).", ""),
    ("Роботи по монтажу та зварюванню підземних та зовнішніх газопроводів, газифікації об'єктів, а також по нанесенню протикорозійного ізоляційного покриття.", "Монтаж, демонтаж, налагодження, ремонт, технічне обслуговування, реконструкція машин, механізмів, устаткування підвищеної небезпеки.", ""),
    ("Роботи по монтажу та зварюванню підземних та зовнішніх газопроводів, газифікації об'єктів, а також по нанесенню протикорозійного ізоляційного покриття.", "Зварювальні, газополум'яні, а також наплавочні і паяльні роботи, що виконуються із застосуванням відкритого полум'я.", ""),
    ("Роботи по монтажу та зварюванню підземних та зовнішніх газопроводів, газифікації об'єктів, а також по нанесенню протикорозійного ізоляційного покриття.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", ""),
    ("Підключення до діючого газопроводу ново змонтованих газопроводів.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Підключення до діючого газопроводу ново змонтованих газопроводів.", "Роботи в колодязях, шурфах, траншеях, котлованах, бункерах, камерах, колекторах, замкнутому просторі (ємностях, боксах, топках, трубопроводах тощо).", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Підключення до діючого газопроводу ново змонтованих газопроводів.", "Монтаж, демонтаж, налагодження, ремонт, технічне обслуговування, реконструкція машин, механізмів, устаткування підвищеної небезпеки.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Підключення до діючого газопроводу ново змонтованих газопроводів.", "Зварювальні, газополум'яні, а також наплавочні і паяльні роботи, що виконуються із застосуванням відкритого полум'я.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Підключення до діючого газопроводу ново змонтованих газопроводів.", "Газонебезпечні роботи та роботи у вибухопожежонебезпечних та/або пожежонебезпечних зонах.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Роботи з отруйними, шкідливими, токсичними та радіоактивними речовинами.", "Виробництво (виготовлення), використання, переробка, зберігання, транспортування, застосування, утилізація та знешкодження вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки, горючих рідин, маса яких дорівнює або перевищує значення нормативів порогових мас", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Роботи по дезактивації, дезінсекції, дератизації та дезінфекції приміщень.", "Виробництво (виготовлення), використання, переробка, зберігання, транспортування, застосування, утилізація та знешкодження вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки, горючих рідин, маса яких дорівнює або перевищує значення нормативів порогових мас", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Виготовлення та застосування скловати, шлаковати, азбесту, мастик на бітумній основі, перхлорвінілових і бакелітових матеріалів.", "Виробництво (виготовлення), використання, переробка, зберігання, транспортування, застосування, утилізація та знешкодження вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки, горючих рідин, маса яких дорівнює або перевищує значення нормативів порогових мас", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Нанесення лако-фарбувальних покрить, ґрунтовок та шпакльовок на основі нітрофарб, полімерних композицій (поліхлорвінілових, епоксидних тощо).", "Нанесення лакофарбових покрить, ґрунтовок та шпакльовок на основі нітрофарб, полімерних композицій (поліхлорвінілових, епоксидних тощо).", ""),
    ("Обробка деревини та інших речовин антисептичними та вогнезахисними сумішами і речовинами.", "Роботи, що виконуються на висоті понад 1,3 метра.", ""),
    ("Роботи, пов'язані з виробництвом, зберіганням, транспортуванням та застосуванням агрохімікатів, пестицидів, гербіцидів.", "Виробництво (виготовлення), використання, переробка, зберігання, транспортування, застосування, утилізація та знешкодження вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки, горючих рідин, маса яких дорівнює або перевищує значення нормативів порогових мас", "Устаткування, пов'язане з виробництвом (виготовленням), використанням, переробкою, зберіганням, транспортуванням, застосуванням, утилізацією чи знешкодженням вибухопожежонебезпечних і небезпечних речовин 1 і 2 класу небезпеки,"),
    ("Робота з піскоструминними апаратами", "Обладнання, що працює під тиском", ""),
    ("Випробування та обслуговування парових і водогрійних котлів, економайзерів, паропроводів, трубопроводів гарячої води, пароперегрівників, теплообмінників, тепломеханічного устаткування, посудин, що працюють під тиском.", "Технічний огляд, випробування, експертне обстеження (технічне діагностування) машин, механізмів, устаткування підвищеної небезпеки.", ""),
    ("Забивання свай.", "Монтаж, демонтаж, налагодження, ремонт, технічне обслуговування, реконструкція машин, механізмів, устаткування підвищеної небезпеки.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Роботи в колодязях, шурфах, траншеях, котлованах, бункерах, камерах і колекторах.", "Роботи в колодязях, шурфах, траншеях, котлованах, бункерах, камерах, колекторах, замкнутому просторі (ємностях, боксах, топках, трубопроводах тощо).", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Роботи верхолазні та на висоті.", "Роботи, що виконуються на висоті понад 1,3 метра.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Роботи з підйомних і підвісних колисок і рихтувань на висоті.", "Роботи, що виконуються на висоті понад 1,3 метра.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Обладнання, що працює під тиском"),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Устаткування напругою понад 1000 В."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Системи газопостачання природним і зрідженим газом суб'єктів господарювання, а також газовикористовуюче обладнання потужністю понад 0,1 МВт."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Машини спеціалізованих перевантажувальних комплексів."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Великотоннажний та інший технологічний транспортний засіб"),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Рухоме обладнання, що працює під тиском,"),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Роботи, що виконуються на висоті понад 1,3 метра."),
    ("Монтаж та демонтаж будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Монтаж, демонтаж та капітальний ремонт будинків, споруд, а також відновлення та зміцнення їх аварійних частин.", "Верхолазні роботи та промисловий альпінізм."),
    ("Обстеження димарів, вентиляційних каналів і дахів при капітальному ремонті будинків та споруд.", "Обстеження, ремонт і чищення димарів, повітропроводів, а також димових та вентиляційних каналів.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Роботи по ремонту, фарбуванню, очистці від снігу та пилу дахів будівель при відсутності огорож.", "Роботи, що виконуються на висоті понад 1,3 метра.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Робота на конструкціях мостових, баштових та козлових кранів.", "Вантажно-розвантажувальні роботи за допомогою машин і механізмів.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Робота на конструкціях мостових, баштових та козлових кранів.", "Роботи, що виконуються на висоті понад 1,3 метра.", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Вантажно-розвантажувальні роботи за допомогою машин і механізмів.", "Вантажно-розвантажувальні роботи за допомогою машин і механізмів.", ""),
    ("Проведення робіт в силосах, призначених для різної сільськогосподарської продукції, в вагонах-зерновозах.", "Роботи в колодязях, шурфах, траншеях, котлованах, бункерах, камерах, колекторах, замкнутому просторі (ємностях, боксах, топках, трубопроводах тощо).", "Вантажопідіймальні крани і машини, ліфти, підйомники для підіймання працівників, пасажирські підвісні канатні дороги, фунікулери, ескалатори та пасажирські конвеєри, колиски приводні для підіймання працівників."),
    ("Роботи по обслуговуванню і ремонту аспіраційних та пневмотранспортних систем на підприємствах по зберіганню і переробці зерна.", "Монтаж, демонтаж, налагодження, ремонт, технічне обслуговування, реконструкція машин, механізмів, устаткування підвищеної небезпеки.", "Машини спеціалізованих перевантажувальних комплексів."),
    ("Роботи по обслуговуванню і ремонту аспіраційних та пневмотранспортних систем на підприємствах по зберіганню і переробці зерна.", "Монтаж, демонтаж, налагодження, ремонт, технічне обслуговування, реконструкція машин, механізмів, устаткування підвищеної небезпеки.", "Рухоме обладнання, що працює під тиском,"),
    ("Роботи по розвантаженню, складанню і зберіганню зернових та олійних культур, висівок, макухи і шротів насипом і в застареному вигляді.", "", "Машини спеціалізованих перевантажувальних комплексів."),
    ("Роботи по розвантаженню, складанню і зберіганню зернових та олійних культур, висівок, макухи і шротів насипом і в застареному вигляді.", "", "Рухоме обладнання, що працює під тиском,"),
    ("Монтаж, ремонт і профілактичне обслуговування засобів охоронної сигналізації.", "Роботи, що виконуються на висоті понад 1,3 метра.", ""),
]

# Словники для збереження унікальних записів
work_types = {}
work_subtypes = {}
equipment_dict = {}

# Імпортуємо дані
for work_type_name, subtype_name, equipment_name in data:
    # Обрізаємо пробіли
    work_type_name = work_type_name.strip()
    subtype_name = subtype_name.strip()
    equipment_name = equipment_name.strip()
    
    # Створюємо або отримуємо тип робіт
    if work_type_name not in work_types:
        work_type, created = WorkType.objects.get_or_create(name=work_type_name)
        work_types[work_type_name] = work_type
        if created:
            print(f"✅ Створено тип робіт: {work_type_name}")
    else:
        work_type = work_types[work_type_name]
    
    # Створюємо або отримуємо підтип робіт
    if subtype_name:
        subtype_key = f"{work_type_name}||{subtype_name}"
        if subtype_key not in work_subtypes:
            work_subtype, created = WorkSubType.objects.get_or_create(
                work_type=work_type,
                name=subtype_name,
                defaults={'has_equipment': bool(equipment_name)}
            )
            work_subtypes[subtype_key] = work_subtype
            if created:
                print(f"  ✅ Створено підтип: {subtype_name}")
        else:
            work_subtype = work_subtypes[subtype_key]
            # Оновлюємо поле has_equipment якщо з'явилось обладнання
            if equipment_name and not work_subtype.has_equipment:
                work_subtype.has_equipment = True
                work_subtype.save()
        
        # Створюємо обладнання якщо є
        if equipment_name:
            equipment_key = f"{subtype_key}||{equipment_name}"
            if equipment_key not in equipment_dict:
                equipment_obj, created = Equipment.objects.get_or_create(
                    subtype=work_subtype,
                    name=equipment_name
                )
                equipment_dict[equipment_key] = equipment_obj
                if created:
                    print(f"    ✅ Створено обладнання: {equipment_name}")

# Виводимо статистику
print("\n📊 СТАТИСТИКА ІМПОРТУ:")
print(f"Типів робіт: {WorkType.objects.count()}")
print(f"Підтипів робіт: {WorkSubType.objects.count()}")
print(f"Обладнання: {Equipment.objects.count()}")
print("\n✅ Імпорт завершено!")